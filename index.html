<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Neo Assistant</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom, #1f1c2c, #928dab);
    color: #fff;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  h1 {
    margin-top: 40px;
    font-size: 3em;
    text-shadow: 2px 2px #000;
  }
  #status {
    margin-top: 20px;
    font-size: 1.2em;
    font-weight: bold;
  }
  #log {
    margin: 20px auto;
    max-width: 600px;
    text-align: left;
    background: rgba(0,0,0,0.3);
    padding: 15px;
    border-radius: 10px;
    height: 300px;
    overflow-y: auto;
  }
  .entry {
    margin-bottom: 10px;
    padding: 5px 10px;
    border-radius: 5px;
  }
  .user { background: rgba(255,255,255,0.2); }
  .neo { background: rgba(0,0,0,0.2); }
</style>
</head>
<body>

<h1>Neo Assistant</h1>
<div id="status">Chargement...</div>
<div id="log"></div>

<script>
const synth = window.speechSynthesis;
let recognition;
let isListening = false;

const statusText = document.getElementById("status");
const logDiv = document.getElementById("log");

// Initialisation reconnaissance vocale
function initRecognition() {
    if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
        alert("Votre navigateur ne supporte pas la reconnaissance vocale. Utilisez Chrome ou Edge.");
        statusText.textContent = "Reconnaissance vocale indisponible.";
        return;
    }

    recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = "fr-FR";
    recognition.interimResults = false;
    recognition.continuous = true;

    recognition.onresult = (event) => {
        const transcript = event.results[event.results.length-1][0].transcript.toLowerCase();
        logEntry("Vous: " + transcript, "user");
        handleCommand(transcript);
    };

    recognition.onstart = () => {
        isListening = true;
        statusText.textContent = "Neo écoute...";
    };

    recognition.onend = () => {
        isListening = false;
        statusText.textContent = "Neo prêt à écouter.";
        // relancer automatiquement pour écoute continue
        recognition.start();
    };

    recognition.onerror = (event) => {
        console.error("Erreur reconnaissance vocale :", event.error);
        statusText.textContent = "Erreur : " + event.error;
        // relancer automatiquement en cas de problème réseau
        if(event.error === 'network' && !isListening){
            setTimeout(() => {
                recognition.start();
            }, 1000); // relance après 1 seconde
        }
    };

    recognition.start();
}

// Fonction pour faire parler Neo
function speak(text) {
    logEntry("Neo: " + text, "neo");
    const utterThis = new SpeechSynthesisUtterance(text);
    utterThis.lang = "fr-FR";
    utterThis.onend = () => {
        statusText.textContent = "Neo prêt à écouter.";
    };
    synth.speak(utterThis);
}

// Ajouter une entrée dans le log
function logEntry(text, type="neo") {
    const div = document.createElement("div");
    div.className = `entry ${type}`;
    div.textContent = text;
    logDiv.appendChild(div);
    logDiv.scrollTop = logDiv.scrollHeight;
}

// Gestion des commandes
function handleCommand(command) {
    if (command.includes("bonjour")) {
        speak("Bonjour ! Comment ça va ?");
    } else if (command.includes("météo")) {
        speak("Je n'ai pas encore la météo, mais bientôt !");
    } else if (command.includes("actualités") || command.includes("news")) {
        speak("Voici les dernières actualités... bientôt implémenté !");
    } else if (command.includes("au revoir")) {
        speak("Au revoir !");
        recognition.stop();
    } else {
        speak("Je n'ai pas compris.");
    }
}

// Lancement de Neo
window.addEventListener('DOMContentLoaded', () => {
    statusText.textContent = "Neo se prépare...";
    initRecognition();
    speak("Bonjour, je suis Neo. Je vous écoute.");
});
</script>

</body>
</html>
